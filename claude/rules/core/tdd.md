---
paths:
  - "**/*.go"
  - "**/*.rs"
  - "**/*.ts"
  - "**/*.lua"
---

# TDD（テスト駆動開発）ルール

すべてのプロダクションコードはKent BeckのTDD方法論に従って記述する。

## TDDサイクル

### 1. REDフェーズ（必須）
実装前に失敗するテストを最初に書く。

- 機能の小さな増分を定義する最もシンプルな失敗テストから開始
- 動作を説明する意味のあるテスト名を使用
- テスト失敗を明確で情報量のあるものにする

### 2. GREENフェーズ（必須）
テストを通過させるための最小限のコードのみを書く。

- 必要最低限のコードのみを実装 - それ以上は書かない
- 現在のテストを通過させることのみに集中

### 3. REFACTORフェーズ（必須）
テストがグリーンになった後のみコード品質を改善。

- 重複を徹底的に排除
- 命名と構造を通じて意図を明確に表現
- メソッドを小さく、単一責任に集中させる
- 依存関係を明示的にする
- 状態と副作用を最小化
- 動作する最もシンプルな解決策を使用

## バグ修正プロセス

バグを修正する際：
1. まずバグを示すAPIレベルの失敗テストを書く
2. 問題を再現する最小のテストを書く
3. 最小限のコード変更で両方のテストを通過させる

## TDD原則

- **実装ではなく動作をテスト**: コードが何をするかに焦点を当て、どのように行うかではない

## 違反パターン（禁止）

- ❌ 失敗するテストなしにプロダクションコードを書く
- ❌ テストを通過させるために必要以上のコードを書く
- ❌ テストがグリーンでないときにリファクタリングする
- ❌ 「後で追加する」意図でテストをスキップする
- ❌ 同じコミットで構造的変更と動作的変更を混ぜる

**覚えておくこと: テストなしにコードなし。これは交渉の余地がない。**

## Tidy Firstアプローチ

すべての変更は2つの異なるタイプに分離する：

### 構造的変更（STRUCTURAL）
動作を変更せずにコードを再配置：
- 変数、メソッド、クラスのリネーム
- メソッドやクラスの抽出
- ファイル間でのコード移動
- コードのフォーマット
- 変更前後にすべてのテストを実行して検証すること

### 動作的変更（BEHAVIORAL）
実際の機能を追加または変更：
- 新機能の追加
- バグの修正
- ビジネスロジックの変更
- 最初に失敗するテストによって駆動されること

**ルール:**
- 同じコミットで構造的変更と動作的変更を混ぜない
- 両方が必要な場合は常に構造的変更を先に行う
- テストを実行して構造的変更が動作を変更していないことを検証
