---
name: base-rules
description: サブエージェント間の共通ルール
color: red
tools: TodoWrite, Write, Read, Grep, Glob
---

# 共通ルールベース

このファイルは全てのサブエージェントが守るべき共通ルールを定義しています。
各エージェントのプロンプトにこの内容を含めてください。

## 必須遵守事項

### 1. バックグラウンドプロセス管理（MANDATORY）

**バックグラウンドで実行されるプロセスはghostで管理する：**

- **必須**: https://github.com/skanehira/ghost を使用（サーバーや監視プロセスなど）
- **禁止**: `&`、`nohup`、`screen`、`tmux` などの従来の方法は絶対に使わない
- **重要**: コマンドオプションが`-`で始まる場合は `--` を使用

```bash
# バックグラウンド実行（ghost必須）
ghost run npm start        # 開発サーバー
ghost run npm test -- --watch  # テスト監視
ghost run python -- -m http.server
ghost list
ghost stop <id>
ghost log <id>

# フォアグラウンド実行（ghost不要）
npm install    # 一回限りの実行
npm test       # 単発のテスト実行
npm build      # ビルドコマンド

# 間違った使い方（絶対禁止）
npm start &
nohup python server.py
```

### 2. 不確実性の扱い（MANDATORY）

**推測は絶対に避け、事実確認を優先する：**

1. **調査優先**: 利用可能なツールで既存コードを調査
2. **明確な表明**: 「わからない」「不確かである」と正直に伝える
3. **選択肢の提示**: 複数のアプローチがある場合は、トレードオフと共に提示
4. **質問する勇気**: 不明な点は必ず質問

```bash
# 良い例
「このプロジェクトのテストフレームワークが不明です。調査させてください」
「要件が曖昧です。XとYのどちらを希望されますか？」

# 悪い例（禁止）
「たぶん○○だと思うので実装します」
「一般的には○○なので、それで進めます」
```

### 3. コミット規則（MANDATORY）

**以下の条件をすべて満たした場合のみコミット：**

1. **すべてのテストが通る** - 例外なし
2. **リンター/コンパイラ警告がない**
3. **単一の論理的な作業単位**
4. **適切なプレフィックス付きメッセージ**

```bash
# コミット前チェック
npm test           # または適切なテストコマンド
npm run lint       # または適切なリントコマンド
npm run typecheck  # 型チェックがある場合

# コミットメッセージ形式
git commit -m "[BEHAVIORAL] feat: ユーザー認証機能を追加"
git commit -m "[STRUCTURAL] refactor: 認証ロジックを別ファイルに分離"
```

### 4. エラーハンドリング

- エラーが発生したら、推測で修正せずに原因を調査
- エラーメッセージを正確に読み、理解してから対処
- 解決できない場合は、明確にその旨を伝える

### 5. 作業の進め方

1. **TodoWriteで計画** - 作業開始前に必ずタスクリストを作成
2. **段階的実行** - 一度に多くの変更をせず、小さなステップで進める
3. **確認の徹底** - 各ステップ後に動作確認
4. **透明性の確保** - 何をしているか、なぜしているかを明確に

## CLAUDE.mdの参照

プロジェクトルートのCLAUDE.mdには、より詳細なルールが記載されています。
必ず参照し、すべてのルールに従ってください。
