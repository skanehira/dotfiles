# ユースケース記述ガイド

## 目次

- [ユースケースの構成要素](#ユースケースの構成要素)
- [フロー記述のルール](#フロー記述のルール)
- [代替フローと例外フロー](#代替フローと例外フロー)
- [ビジネスルールの抽出](#ビジネスルールの抽出)
- [よくある間違い](#よくある間違い)

## ユースケースの構成要素

### 必須要素

| 要素 | 説明 | 例 |
|------|------|-----|
| **ユースケース名** | 動詞で始まる簡潔な名前 | SQLを分析して改善案を得る |
| **主アクター** | ユースケースを開始する人/システム | 開発者 |
| **事前条件** | 開始に必要な状態 | ログイン済み |
| **事後条件** | 成功時の状態 | 改善案が保存されている |
| **正常系フロー** | 基本シナリオ | 1. 入力 → 2. 送信 → 3. 表示 |

### オプション要素

| 要素 | 説明 |
|------|------|
| **副アクター** | 処理に協力するシステム（AIエンジン、外部API等） |
| **トリガー** | ユースケースを開始するきっかけ |
| **代替フロー** | 正常系から分岐する別パス |
| **例外フロー** | エラーや異常時の処理 |
| **ビジネスルール** | 適用される制約やルール |

## フロー記述のルール

### 基本フォーマット

```
番号. [アクター] が [アクション] する
```

### 良い記述

```
1. 開発者がSQL入力欄にクエリを入力する
2. 開発者が「分析」ボタンをクリックする
3. システムがAIエンジンに改善案を要求する
4. AIエンジンが改善案を3つ返す
5. システムが改善案を一覧表示する
```

### 悪い記述

```
❌ 抽象的すぎる
1. ユーザーが操作する
2. システムが処理する

❌ 実装詳細に踏み込みすぎ
1. ユーザーがPOST /api/v1/analyze を呼び出す
2. システムがRedisキャッシュを確認する
```

### アクターの書き方

| 良い例 | 悪い例 |
|--------|--------|
| 開発者 | ユーザー（曖昧） |
| 管理者 | 人（曖昧） |
| システム | サーバー（実装詳細） |
| AIエンジン | GPT-4（製品名） |

## 代替フローと例外フロー

### 代替フロー（Alternative Flow）

正常系の**別の選択肢**。ユーザーが意図的に選ぶパス。

```
正常系: ステップ2でスキーマを手動入力する

代替フロー A: ステップ2でスキーマをファイルからインポート
2a. 開発者が「インポート」ボタンをクリックする
2b. システムがファイル選択ダイアログを表示する
2c. 開発者がDDLファイルを選択する
2d. システムがスキーマをパースして入力欄に反映する
→ ステップ3に戻る
```

### 例外フロー（Exception Flow）

**エラーや異常**が発生した場合の処理。

```
例外フロー E1: ステップ4でAIエンジンがタイムアウト
条件: 30秒以内にAIから応答がない場合
4a. システムが「処理に時間がかかっています」と表示する
4b. システムがバックグラウンドで処理を継続する
4c. 完了したらメールで通知する
```

### 違いのまとめ

| 種類 | 発生条件 | 例 |
|------|----------|-----|
| **代替フロー** | ユーザーの選択 | ファイルからインポート、Googleでログイン |
| **例外フロー** | エラー・異常 | タイムアウト、バリデーションエラー |

## ビジネスルールの抽出

### ビジネスルールとは

システムの振る舞いを規定する**制約や条件**。

### 見つけるための質問

- 「〇〇できる条件は何ですか？」
- 「上限や下限はありますか？」
- 「〇〇と△△の関係にルールはありますか？」
- 「自動的に行われる処理はありますか？」

### ビジネスルールの種類

| 種類 | 説明 | 例 |
|------|------|-----|
| **制約** | 値の範囲や形式 | SQLは最大10クエリまで |
| **計算** | 導出値の算出方法 | 改善率 = (旧-新)/旧 × 100 |
| **推論** | 条件に基づく判断 | 改善率30%以上で「効果大」 |
| **アクション** | 条件によるトリガー | 分析完了後にSlack通知 |

### 記述フォーマット

```
BR-001: [ルール名]
条件: [いつ適用されるか]
内容: [具体的なルール]
```

例:
```
BR-001: SQL入力上限
条件: SQL入力時
内容: 1回の分析で入力できるSQLは最大10クエリまで

BR-002: 改善案生成数
条件: 分析実行時
内容: 改善案は最低3つ、最大10個生成する

BR-003: 無料プラン制限
条件: 無料プランユーザーの場合
内容: 1日5回まで分析可能。超過時はアップグレード案内を表示
```

## よくある間違い

### 1. UIの詳細を書きすぎ

```
❌ 「青い送信ボタン（#0066CC）を右下に配置」
✅ 「開発者が送信ボタンをクリックする」
```

### 2. 実装詳細に踏み込む

```
❌ 「システムがPostgreSQLにINSERTクエリを実行する」
✅ 「システムが改善案を保存する」
```

### 3. 事前条件の欠落

```
❌ 事前条件なしで「改善案を表示する」を開始
✅ 事前条件: ログイン済み、SQLを入力済み
```

### 4. 曖昧なアクター

```
❌ 「ユーザーが操作する」
✅ 「開発者がSQLを入力する」
```

### 5. 例外フローの欠落

```
❌ 正常系だけで「システムが改善案を表示する」
✅ 例外: タイムアウト時、エラー時の処理も記述
```
