---
name: requirements-analysis
description: ユーザー要件を分析し、実装可能なタスクに分解する。ユーザーの要求が曖昧な場合、大規模な機能開発が必要な場合、詳細なタスク分解が必要な場合に使用する。MUSTルールに従ってTODO.mdとDESIGN.mdファイルを生成する。
---

# 要件分析

## 概要

曖昧なユーザーリクエストを具体的で実行可能な実装計画に変換する。要件を深く理解し、技術的実現可能性を検証し、依存関係を考慮したタスク構造化を行い、開発者が迷わず従える詳細なTODOリストを生成する。

## このスキルを使用するタイミング

以下の場合にこのスキルを使用する：
- ユーザー要件が曖昧または不明確な場合
- 大規模な機能開発に計画が必要な場合
- 複雑なタスクを小さなステップに分解する必要がある場合
- 実装計画を確立する必要がある場合
- TODO.mdとDESIGN.mdドキュメントが必要な場合

## コアワークフロー

### ステップ0: MUSTルールの確認（必須）

分析を開始する前に、`references/must-rules.md`のすべてのMUSTルールを確認する：
- テスト駆動開発（TDD）は必須
- Tidy Firstアプローチは必須
- 不確実性への対処は必須
- バックグラウンドプロセス管理は必須
- ドキュメント検索は必須
- コミット規律は必須

すべてのタスク分解はこれらのルールに準拠する必要がある。

### ステップ1: 要件の理解と分析

ユーザーリクエストを複数の観点から分析する：

**何を構築するか（What）**
- コア機能の特定
- 機能スコープの定義
- ユーザーインターフェース要件

**目的と価値（Why）**
- ビジネス価値の分析
- 解決する問題
- 成功指標

**使用パターン（How）**
- ユーザーインタラクションフロー
- 統合ポイント
- パフォーマンス要件

**タイムライン（When）**
- 納品期待値
- マイルストーン計画
- 依存関係のタイミング

**対象ユーザー（Who）**
- ユーザーペルソナ
- アクセスパターン
- スキルレベルの考慮

### ステップ2: 不確実性の解消

**必須: 決して仮定を立てない**

利用可能なツールを使用して既存の実装を調査する：
```bash
# 関連する実装を検索
Grep(pattern="relevant-keyword")
Read(file_path="related-file")
Glob(pattern="**/*.{js,ts,py}")
```

情報が不足している場合、不明点を明示的にリストアップする：
```
「以下の点について確認が必要です:
- ポイント1: ○○について
- ポイント2: △△の仕様
- ポイント3: □□の制約」
```

### ステップ3: 要件定義の作成

要件を明確に構造化する：

#### 機能要件
- 必須機能（MUST have）
- オプション機能（NICE to have）
- 将来の拡張性の考慮

#### 非機能要件
- パフォーマンス目標
- セキュリティ要件
- 保守性基準
- スケーラビリティニーズ

#### 制約
- 技術的制約（言語、フレームワーク、依存関係）
- 時間的制約（締め切り、マイルストーン）
- リソース制約（チームサイズ、インフラ）

### ステップ4: タスク分解（MUSTルール準拠）

TDDとTidy Firstの原則に従って作業をフェーズに分解する：

**フェーズ1: 基盤**
- プロジェクト構造設計
- パッケージ選定
- 基本セットアップ

**フェーズ2: コア実装（TDD準拠）**
各機能はRED→GREEN→REFACTORサイクルに従う：
```markdown
- [ ] [RED] 機能Xの失敗するテストを書く
- [ ] [GREEN] テストを通す最小限の実装
- [ ] [GREEN] テストが通るまで実装を調整
- [ ] [REFACTOR] 重複を排除し、コード品質を改善
- [ ] [RED] 次の機能の失敗するテストを書く
- [ ] [GREEN] 最小限の実装
- [ ] [GREEN] すべてのテストを通す
- [ ] [REFACTOR] コード改善
```

**フェーズ3: 品質向上（Tidy First準拠）**
```markdown
- [ ] [STRUCTURAL] コードクリーンアップとリファクタリング（振る舞い変更なし）
- [ ] [BEHAVIORAL] エラーハンドリングのテストと実装
- [ ] パフォーマンステスト
```

### ステップ5: TODOリスト生成

TodoWriteを使用して構造化されたタスクリストを作成する：
```javascript
TodoWrite({
  todos: [
    {
      id: "1",
      content: "プロジェクト構造設計と初期セットアップ",
      status: "pending"
    },
    {
      id: "2",
      content: "[RED] ユーザー認証の振る舞いテストを書く",
      status: "pending"
    },
    {
      id: "3",
      content: "[GREEN] 認証テストを通す最小限の実装",
      status: "pending"
    },
    {
      id: "4",
      content: "[GREEN] 認証テストが通るまで実装を調整",
      status: "pending"
    },
    {
      id: "5",
      content: "[REFACTOR] 認証コード品質の改善",
      status: "pending"
    },
    {
      id: "6",
      content: "[STRUCTURAL] コードクリーンアップ（振る舞い変更なし）",
      status: "pending"
    }
    // 詳細なTDDサイクルタスクを続ける
  ]
})
```

### ステップ6: ドキュメント出力

2つの主要ドキュメントを生成する：

#### docs/TODO.md
```markdown
# TODO: [プロジェクト名]

生成日: [日付]
ジェネレーター: requirements-analysis

## 概要
[プロジェクト概要と目的]

## 実装タスク（MUSTルール準拠）

### フェーズ1: 基盤
- [ ] プロジェクト構造設計と初期セットアップ
- [ ] 開発環境セットアップ（バックグラウンドプロセスにはghost使用）

### フェーズ2: TDD準拠コア実装
- [ ] [RED] 機能Aの振る舞いテストを書く
- [ ] [GREEN] テストを通す最小限の実装
- [ ] [GREEN] テストが通るまで調整
- [ ] [REFACTOR] 重複を排除し品質改善
- [ ] [RED] 機能Bの振る舞いテストを書く
- [ ] [GREEN] 最小限の実装
- [ ] [GREEN] すべてのテストを通す
- [ ] [REFACTOR] コード品質改善

### フェーズ3: 品質向上（Tidy First準拠）
- [ ] [STRUCTURAL] コードクリーンアップとリファクタリング（振る舞い変更なし）
- [ ] [BEHAVIORAL] エラーハンドリングのテストと実装
- [ ] すべてのテストを実行し品質を確認

## 実装ノート（MUSTルール準拠）
- TDD: 常にテストファースト（RED → GREEN → REFACTOR）
- Tidy First: コミットで構造変更と振る舞い変更を分離
- バックグラウンドプロセス: ghost使用（禁止: &, nohup等）
- 不確実性: 質問して調査、決して仮定しない
- コミット: [STRUCTURAL]または[BEHAVIORAL]プレフィックス必須

## 参照
- 設計ドキュメント: docs/DESIGN.md
- 関連ドキュメント: [リンク]
```

#### docs/DESIGN.md
```markdown
# [プロジェクト名] 設計ドキュメント

生成日: [日付]
ジェネレーター: requirements-analysis

## システム概要
[システムの目的と全体像]

## アーキテクチャ設計
[システム構成と技術選定]

## 詳細設計
[コンポーネント設計、API設計など]

## データ設計
[データモデル、データフロー]

## セキュリティ設計
[セキュリティ要件と対策]

## パフォーマンス設計
[パフォーマンス要件と最適化方針]
```

### ステップ7: ファイル出力

ドキュメントファイルを書き出す：
```javascript
// docsディレクトリにTODO.mdを出力
Write(
    file_path="docs/TODO.md",
    content=todoContent
)

// docsディレクトリにDESIGN.mdを出力
Write(
    file_path="docs/DESIGN.md",
    content=designContent
)
```

## タスク分解の原則

### SMART原則
- **Specific（具体的）**: 明確で具体的
- **Measurable（測定可能）**: 明確な完了基準
- **Achievable（達成可能）**: 現実的に達成可能
- **Relevant（関連性）**: 目的に関連
- **Time-bound（期限）**: 時間見積もりが可能

### 依存関係の明確化
```
タスクA → タスクB → タスクC
           ↗
タスクD ↗
```

### タスクサイズ
- 1タスク = 1〜4時間で完了可能
- 大きすぎる場合はサブタスクに分割
- 小さすぎる場合は統合

## 品質チェックリスト

分析完了前に確認：
- [ ] すべての要件が仕様に反映されている
- [ ] 技術的実現可能性が確認されている
- [ ] タスクの依存関係が明確
- [ ] 各タスクに明確な完了基準がある
- [ ] 優先度が適切に設定されている
- [ ] すべてのMUSTルール準拠が確認されている
- [ ] TODO.mdとDESIGN.mdが生成されている

## リソース

### ../../shared/references/must-rules.md
CLAUDE.mdから抽出した詳細なMUSTルール、以下を含む：
- TDD方法論の詳細
- Tidy First原則
- 不確実性対処ガイドライン
- バックグラウンドプロセス管理
- ドキュメント検索手順
- コミット規律基準

分析中の包括的なルール詳細についてはこのファイルを参照。
